=== ARBORESCENCE ===

.gitignore
[config]/
  Config.php
  dev.ini
  dev_sample.ini
[controllers]/
  MainController.php
  PersonnageController.php
  [Router]/
    [Route]/
      RouteAddOrigin.php
      RouteAddPerso.php
      RouteAddPersoElement.php
      RouteAddUnitClass.php
      RouteDelPerso.php
      RouteEditPerso.php
      RouteIndex.php
      RouteLogin.php
      RouteLogs.php
    Route.php
    Router.php
[exceptions]/
[helpers]/
  Message.php
  Psr4AutoloaderClass.php
index.php
[models]/
  BasePDODAO.php
  Element.php
  ElementDAO.php
  Origin.php
  OriginDAO.php
  Personnage.php
  PersonnageDAO.php
  UnitClass.php
  UnitClassDAO.php
[public]/
  [css]/
    main.css
  [img]/
[services]/
[vendor]/
  [plates]/
[views]/
  add-origin.php
  add-perso-element.php
  add-perso.php
  add-unitclass.php
  home.php
  login.php
  logs.php
  message.php
  template.php


=== FICHIERS ET CONTENU ===


--- .gitignore ---

config/dev.ini

--- config\Config.php ---

<?php

namespace Config;

use Exception;

class Config
{
    private static ?array $param = null;

    // Renvoie la valeur d'un paramètre de configuration
    public static function get(string $nom, $valeurParDefaut = null)
    {
        if (isset(self::getParameter()[$nom])) {
            $valeur = self::getParameter()[$nom];
        } else {
            $valeur = $valeurParDefaut;
        }
        return $valeur;
    }

    // Charge le fichier ini (prod.ini si existe, sinon dev.ini)
    private static function getParameter(): array
    {
        if (self::$param === null) {

            // On cherche d'abord un prod.ini puis un dev.ini
            $cheminFichier = __DIR__ . '/prod.ini';
            if (!file_exists($cheminFichier)) {
                $cheminFichier = __DIR__ . '/dev.ini';
            }

            if (!file_exists($cheminFichier)) {
                throw new Exception("Aucun fichier de configuration trouvé");
            } else {
                // [DB] dsn=... user=... pass=...
                // parse_ini_file sans 2e param => les clés sont 'dsn','user','pass'
                self::$param = parse_ini_file($cheminFichier);
            }
        }

        return self::$param;
    }
}






--- config\dev.ini ---

;config dev
[DB]
dsn = 'mysql:host=localhost;dbname=projetphpbdd;charset=utf8';
user = 'root';
pass = '';

--- config\dev_sample.ini ---

;config dev
[DB]
dsn = 'mysql:host=localhost;dbname=YOURDBNAME;charset=utf8';
user = 'YOUR_USERNAME';
pass = 'YOUR_PASSWORD';






--- controllers\MainController.php ---

<?php

namespace Controllers;

use League\Plates\Engine;
use Models\PersonnageDAO;
use Helpers\Message;

class MainController
{
    private Engine $templates;

    public function __construct()
    {
        $this->templates = new Engine(__DIR__ . '/../views');
    }

    /**
     * Page d’accueil : liste des personnages
     *
     * @param mixed $message Peut être null, string ou Helpers\Message
     */
    public function index($message = null): void
    {
        $dao = new PersonnageDAO();

        // Récupère tous les personnages
        $listPersonnage = $dao->getAll();

        echo $this->templates->render('home', [
            'gameName'       => 'Genshin Impact',
            'listPersonnage' => $listPersonnage,
            'message'        => $message,
        ]);
    }

    public function logs($message = null): void
    {
        echo $this->templates->render('logs', [
            'message' => $message,
        ]);
    }

    public function login($message = null): void
    {
        echo $this->templates->render('login', [
            'message' => $message,
        ]);
    }
}


--- controllers\PersonnageController.php ---

<?php

namespace Controllers;

use League\Plates\Engine;
use Models\Personnage;
use Models\PersonnageDAO;
use Helpers\Message;

class PersonnageController
{
    private Engine $templates;
    private PersonnageDAO $dao;
    private MainController $mainController;

    public function __construct()
    {
        $this->templates      = new Engine(__DIR__ . '/../views');
        $this->dao            = new PersonnageDAO();
        $this->mainController = new MainController();
    }

    /**
     * Affiche le formulaire d'ajout de personnage
     */
    public function displayAddPerso($message = null): void
    {
        $elementDAO   = new \Models\ElementDAO();
        $originDAO    = new \Models\OriginDAO();
        $unitclassDAO = new \Models\UnitClassDAO();

        echo $this->templates->render('add-perso', [
            'message'     => $message,
            'mode'        => 'create',
            'elements'    => $elementDAO->getAll(),
            'origins'     => $originDAO->getAll(),
            'unitclasses' => $unitclassDAO->getAll(),
        ]);
    }

    /**
     * Affiche le formulaire d'édition pré-rempli
     */
    public function displayEditPerso(string $idPerso, $message = null): void
    {
        $perso = $this->dao->getByID($idPerso);

        if ($perso === null) {
            $this->mainController->index(
                new Message("Personnage introuvable.", Message::COLOR_ERROR, "Erreur")
            );
            return;
        }

        $elementDAO   = new \Models\ElementDAO();
        $originDAO    = new \Models\OriginDAO();
        $unitclassDAO = new \Models\UnitClassDAO();

        echo $this->templates->render('add-perso', [
            'message'     => $message,
            'mode'        => 'edit',
            'perso'       => $perso,
            'elements'    => $elementDAO->getAll(),
            'origins'     => $originDAO->getAll(),
            'unitclasses' => $unitclassDAO->getAll(),
        ]);
    }

    public function displayAddPersoElement($message = null): void
{
    echo $this->templates->render('add-perso-element', [
        'message' => $message
    ]);
}

    /**
     * Création d'un personnage (POST)
     */
    public function addPerso(array $data): void
    {
        $perso = new Personnage();
        $perso->setId(uniqid('', true));
        $perso->setName($data['name']);
        $perso->setRarity((int)$data['rarity']);
        $perso->setUrlImg($data['url_img']);

        // IDs venant des <select>
        $perso->setElementId((int)$data['element']);
        $perso->setUnitclassId((int)$data['unitclass']);
        $perso->setOriginId($data['origin'] !== '' ? (int)$data['origin'] : null);

        $ok = $this->dao->createPersonnage($perso);

        $message = $ok
            ? new Message(
                "Personnage créé avec succès.",
                Message::COLOR_SUCCESS,
                "Création réussie"
            )
            : new Message(
                "Erreur lors de la création du personnage.",
                Message::COLOR_ERROR,
                "Erreur de création"
            );

        $this->mainController->index($message);
    }

    /**
     * Mise à jour d'un personnage existant (POST)
     */
    public function editPerso(array $data): void
    {
        $perso = $this->dao->getByID($data['idPerso']);

        if ($perso === null) {
            $message = new Message(
                "Personnage introuvable pour modification.",
                Message::COLOR_ERROR,
                "Erreur"
            );
            $this->mainController->index($message);
            return;
        }

        $perso->setName($data['name']);
        $perso->setRarity((int)$data['rarity']);
        $perso->setUrlImg($data['url_img']);

        $perso->setElementId((int)$data['element']);
        $perso->setUnitclassId((int)$data['unitclass']);
        $perso->setOriginId($data['origin'] !== '' ? (int)$data['origin'] : null);

        $ok = $this->dao->updatePersonnage($perso);

        $message = $ok
            ? new Message(
                "Personnage modifié avec succès.",
                Message::COLOR_SUCCESS,
                "Modification réussie"
            )
            : new Message(
                "Aucune modification effectuée (vérifiez les données).",
                Message::COLOR_INFO,
                "Information"
            );

        $this->mainController->index($message);
    }

    public function deletePersoAndIndex(?string $idPerso = null): void
    {
        if ($idPerso === null) {
            $message = new Message(
                "Aucun identifiant de personnage fourni.",
                Message::COLOR_ERROR,
                "Erreur de suppression"
            );
            $this->mainController->index($message);
            return;
        }

        $ok = $this->dao->deletePerso($idPerso);

        $message = $ok
            ? new Message(
                "Personnage supprimé avec succès.",
                Message::COLOR_SUCCESS,
                "Suppression réussie"
            )
            : new Message(
                "Aucun personnage supprimé (id introuvable ?).",
                Message::COLOR_ERROR,
                "Erreur de suppression"
            );

        $this->mainController->index($message);
    }

    public function displayAddUnitClass($message = null): void
{
    echo $this->templates->render('add-unitclass', [
        'message' => $message
    ]);
}

    public function displayAddOrigin($message = null): void
{
    echo $this->templates->render('add-origin', [
        'message' => $message
    ]);
}



    
}


--- controllers\Router\Route\RouteAddOrigin.php ---

<?php

namespace Controllers\Router\Route;

use Controllers\PersonnageController;
use Controllers\Router\Route;
use Models\Origin;
use Models\OriginDAO;
use Helpers\Message;
use Exception;

class RouteAddOrigin extends Route
{
    private PersonnageController $controller;

    public function __construct(PersonnageController $controller)
    {
        $this->controller = $controller;
    }

    public function get(array $params = []): void
    {
        $this->controller->displayAddOrigin();
    }

    public function post(array $params = []): void
    {
        try {
            $name   = $this->getParam($params, 'origin-name', false);
            $imgUrl = $this->getParam($params, 'origin-img', true);

            $origin = new Origin();
            $origin->setName($name);
            $origin->setUrlImg($imgUrl ?: null);

            $dao = new OriginDAO();
            $ok = $dao->createOrigin($origin);

            $message = $ok
                ? new Message("Origine ajoutée avec succès.", Message::COLOR_SUCCESS, "Succès")
                : new Message("Erreur lors de l’ajout de l’origine.", Message::COLOR_ERROR, "Erreur");

            $this->controller->displayAddOrigin($message);

        } catch (Exception $e) {
            $this->controller->displayAddOrigin(
                new Message("Erreur : " . $e->getMessage(), Message::COLOR_ERROR, "Erreur")
            );
        }
    }
}


--- controllers\Router\Route\RouteAddPerso.php ---

<?php

namespace Controllers\Router\Route;

use Controllers\PersonnageController;
use Exception;
use Controllers\Router\Route;


class RouteAddPerso extends Route
{
    private PersonnageController $controller;

    public function __construct(PersonnageController $controller)
    {
        $this->controller = $controller;
    }

    public function get(array $params = []): void
    {
        // Affiche simplement le formulaire vide
        $this->controller->displayAddPerso();
    }

    public function post(array $params = []): void
    {
        try {
            // On récupère les champs (obligatoires sauf origin)
            $data = [
                'name'      => $this->getParam($params, 'perso-nom', false),
                'element'   => $this->getParam($params, 'perso-element', false),
                'unitclass' => $this->getParam($params, 'perso-unitclass', false),
                'rarity'    => $this->getParam($params, 'perso-rarity', false),
                'origin'    => $this->getParam($params, 'perso-origin', true),
                'url_img'   => $this->getParam($params, 'perso-url-img', false),
            ];

            $this->controller->addPerso($data);
        } catch (Exception $e) {
            // En cas de champ manquant ou vide
            $this->controller->displayAddPerso("Erreur dans le formulaire : " . $e->getMessage());
        }
    }
}


--- controllers\Router\Route\RouteAddPersoElement.php ---

<?php

namespace Controllers\Router\Route;

use Controllers\PersonnageController;
use Controllers\Router\Route;
use Exception;
use Models\Element;
use Models\ElementDAO;
use Helpers\Message;

class RouteAddPersoElement extends Route
{
    private PersonnageController $controller;

    public function __construct(PersonnageController $controller)
    {
        $this->controller = $controller;
    }

    public function get(array $params = []): void
    {
        $this->controller->displayAddPersoElement();
    }

    public function post(array $params = []): void
    {
        try {
            $name   = $this->getParam($params, 'element-name', false);
            $imgUrl = $this->getParam($params, 'element-img', false);

            $element = new Element();
            $element->setName($name);
            $element->setUrlImg($imgUrl);

            $dao = new ElementDAO();
            $ok = $dao->createElement($element);

            $message = $ok
                ? new Message("Élément ajouté avec succès.", Message::COLOR_SUCCESS, "Succès")
                : new Message("Erreur lors de l’ajout de l’élément.", Message::COLOR_ERROR, "Erreur");

            // On retourne au formulaire
            $this->controller->displayAddPersoElement($message);

        } catch (Exception $e) {
            $this->controller->displayAddPersoElement(
                new Message("Erreur dans le formulaire : " . $e->getMessage(), Message::COLOR_ERROR, "Erreur")
            );
        }
    }
}


--- controllers\Router\Route\RouteAddUnitClass.php ---

<?php

namespace Controllers\Router\Route;

use Controllers\PersonnageController;
use Controllers\Router\Route;
use Models\UnitClass;
use Models\UnitClassDAO;
use Helpers\Message;
use Exception;

class RouteAddUnitClass extends Route
{
    private PersonnageController $controller;

    public function __construct(PersonnageController $controller)
    {
        $this->controller = $controller;
    }

    public function get(array $params = []): void
    {
        $this->controller->displayAddUnitClass();
    }

    public function post(array $params = []): void
    {
        try {
            $name   = $this->getParam($params, 'unitclass-name', false);
            $imgUrl = $this->getParam($params, 'unitclass-img', true);

            $uc = new UnitClass();
            $uc->setName($name);
            $uc->setUrlImg($imgUrl ?: null);

            $dao = new UnitClassDAO();
            $ok = $dao->createUnitClass($uc);

            $message = $ok
                ? new Message("Classe ajoutée avec succès.", Message::COLOR_SUCCESS, "Succès")
                : new Message("Erreur lors de l’ajout de la classe.", Message::COLOR_ERROR, "Erreur");

            $this->controller->displayAddUnitClass($message);

        } catch (Exception $e) {
            $this->controller->displayAddUnitClass(
                new Message("Erreur : " . $e->getMessage(), Message::COLOR_ERROR, "Erreur")
            );
        }
    }
}


--- controllers\Router\Route\RouteDelPerso.php ---

<?php

namespace Controllers\Router\Route;

use Controllers\PersonnageController;
use Exception;
use Controllers\Router\Route;

class RouteDelPerso extends Route
{
    private PersonnageController $controller;

    public function __construct(PersonnageController $controller)
    {
        $this->controller = $controller;
    }

    public function get(array $params = []): void
    { 
        try {
            $idPerso = $this->getParam($params, 'id', false);
            $this->controller->deletePersoAndIndex($idPerso);
        } catch (Exception $e) {
            // Pas d’id dans l’URL → message générique
            $this->controller->deletePersoAndIndex(null);
        }
    }

    public function post(array $params = []): void
    {
        // On ne supprime qu’en GET dans ce TP
        $this->get($params);
    }
}


--- controllers\Router\Route\RouteEditPerso.php ---

<?php

namespace Controllers\Router\Route;

use Controllers\PersonnageController;
use Controllers\Router\Route;
use Exception;

class RouteEditPerso extends Route
{
    private PersonnageController $controller;

    public function __construct(PersonnageController $controller)
    {
        $this->controller = $controller;
    }

    /**
     * Affiche le formulaire d’édition pré-rempli
     */
    public function get(array $params = []): void
    {
        try {
            // On récupère l’id du personnage dans l’URL
            $idPerso = $this->getParam($params, 'id', false);
            $this->controller->displayEditPerso($idPerso);
        } catch (Exception $e) {
            // Pas d’id → on renvoie simplement sur le formulaire d’ajout
            $this->controller->displayAddPerso("Aucun identifiant de personnage pour la modification.");
        }
    }

    /**
     * Traite la soumission du formulaire d’édition
     */
    public function post(array $params = []): void
    {
        try {
            $data = [
                'idPerso'   => $this->getParam($params, 'idPerso', false),
                'name'      => $this->getParam($params, 'perso-nom', false),
                'element'   => $this->getParam($params, 'perso-element', false),
                'unitclass' => $this->getParam($params, 'perso-unitclass', false),
                'rarity'    => $this->getParam($params, 'perso-rarity', false),
                'origin'    => $this->getParam($params, 'perso-origin', true),
                'url_img'   => $this->getParam($params, 'perso-url-img', false),
            ];

            $this->controller->editPerso($data);
        } catch (Exception $e) {
            // Si erreur dans les champs, on essaie de réafficher le form d’édition
            $idPerso = $params['idPerso'] ?? null;

            $message = "Erreur dans le formulaire : " . $e->getMessage();

            if ($idPerso !== null) {
                $this->controller->displayEditPerso($idPerso, $message);
            } else {
                $this->controller->displayAddPerso($message);
            }
        }
    }
}


--- controllers\Router\Route\RouteIndex.php ---

<?php

namespace Controllers\Router\Route;

use Controllers\MainController;
use Controllers\Router\Route;

class RouteIndex extends Route
{
    private MainController $controller;

    public function __construct(MainController $controller)
    {
        $this->controller = $controller;
    }

    public function get(array $params = []): void
    {
        // Page d'accueil
        $this->controller->index();
    }

    public function post(array $params = []): void
    {
        // Pour l’instant, même chose
        $this->controller->index();
    }
}


--- controllers\Router\Route\RouteLogin.php ---

<?php

namespace Controllers\Router\Route;

use Controllers\MainController;
use Controllers\Router\Route;

class RouteLogin extends Route
{
    private MainController $controller;

    public function __construct(MainController $controller)
    {
        $this->controller = $controller;
    }

    public function get(array $params = []): void
    {
        $this->controller->login();
    }

    public function post(array $params = []): void
    {
        $this->controller->login();
    }
}


--- controllers\Router\Route\RouteLogs.php ---

<?php

namespace Controllers\Router\Route;

use Controllers\MainController;
use Controllers\Router\Route;

class RouteLogs extends Route
{
    private MainController $controller;

    public function __construct(MainController $controller)
    {
        $this->controller = $controller;
    }

    public function get(array $params = []): void
    {
        $this->controller->logs();
    }

    public function post(array $params = []): void
    {
        $this->controller->logs();
    }
}


--- controllers\Router\Route.php ---

<?php

namespace Controllers\Router;

use Exception;

abstract class Route
{
    /**
     * Méthode principale appelée par le router
     */
    public function action(array $params = [], string $method = 'GET'): void
    {
        if ($method === 'POST') {
            $this->post($params);
        } else {
            $this->get($params);
        }
    }

    /**
     * Récupère un paramètre dans un tableau (GET ou POST)
     */
    protected function getParam(array $array, string $paramName, bool $canBeEmpty = true): mixed
    {
        if (isset($array[$paramName])) {
            if (!$canBeEmpty && empty($array[$paramName])) {
                throw new Exception("Paramètre '$paramName' vide");
            }
            return $array[$paramName];
        }

        throw new Exception("Paramètre '$paramName' absent");
    }

    abstract public function get(array $params = []): void;

    abstract public function post(array $params = []): void;
}


--- controllers\Router\Router.php ---

<?php

namespace Controllers\Router;

use Controllers\MainController;
use Controllers\PersonnageController;
use Controllers\Router\Route\Route;
use Controllers\Router\Route\RouteIndex;
use Controllers\Router\Route\RouteAddPerso;
use Controllers\Router\Route\RouteAddPersoElement;
use Controllers\Router\Route\RouteLogs;
use Controllers\Router\Route\RouteLogin;
use Controllers\Router\Route\RouteEditPerso;
use Controllers\Router\Route\RouteDelPerso;
use Controllers\Router\Route\RouteAddUnitClass;
use Controllers\Router\Route\RouteAddOrigin;




class Router
{
    /** @var array<string, Route> */
    private array $routeList = [];

    /** @var array<string, object> */
    private array $ctrlList  = [];

    private string $actionKey;

    public function __construct(string $name_of_action_key = 'action')
    {
        $this->actionKey = $name_of_action_key;

        $this->createControllerList();
        $this->createRouteList();
    }

    private function createControllerList(): void
{
    $this->ctrlList['main']  = new MainController();
    $this->ctrlList['perso'] = new PersonnageController();
}



    private function createRouteList(): void
{
    $this->routeList['index']             = new RouteIndex($this->ctrlList['main']);
    $this->routeList['add-perso']         = new RouteAddPerso($this->ctrlList['perso']);
    $this->routeList['add-perso-element'] = new RouteAddPersoElement($this->ctrlList['perso']);
    $this->routeList['logs']              = new RouteLogs($this->ctrlList['main']);
    $this->routeList['login']             = new RouteLogin($this->ctrlList['main']);

    
    $this->routeList['edit-perso']        = new RouteEditPerso($this->ctrlList['perso']);
    $this->routeList['del-perso']         = new RouteDelPerso($this->ctrlList['perso']);
    $this->routeList['add-unitclass'] = new RouteAddUnitClass($this->ctrlList['perso']);
    $this->routeList['add-origin'] = new RouteAddOrigin($this->ctrlList['perso']);


}



public function routing(array $get, array $post): void
{
    $action = $get[$this->actionKey] ?? 'index';
    
    $route = $this->routeList[$action] ?? $this->routeList['index'];
    
    $method = !empty($post) ? 'POST' : 'GET';

    if ($method === 'POST') {
        $route->action($post, 'POST');
    } else {
        $route->action($get, 'GET');
    }
}
}

--- helpers\Message.php ---

<?php

namespace Helpers;

class Message
{
    public const COLOR_INFO    = 'alert-info';
    public const COLOR_SUCCESS = 'alert-success';
    public const COLOR_ERROR   = 'alert-error';

    private string $message;
    private string $color;
    private string $title;

    public function __construct(
        string $message,
        string $color = self::COLOR_INFO,
        string $title = 'Information'
    ) {
        $this->message = $message;
        $this->color   = $color;
        $this->title   = $title;
    }

    public function getMessage(): string
    {
        return $this->message;
    }

    public function getColor(): string
    {
        return $this->color;
    }

    public function getTitle(): string
    {
        return $this->title;
    }
}


--- helpers\Psr4AutoloaderClass.php ---

<?php

namespace Helpers;

/**
 * An example of a general-purpose implementation that includes the optional
 * functionality of allowing multiple base directories for a single namespace
 * prefix.
 *
 * Given a foo-bar package of classes in the file system at the following
 * paths ...
 *
 *     /path/to/packages/foo-bar/
 *         src/
 *             Baz.php             # Foo\Bar\Baz
 *             Qux/
 *                 Quux.php        # Foo\Bar\Qux\Quux
 *         tests/
 *             BazTest.php         # Foo\Bar\BazTest
 *             Qux/
 *                 QuuxTest.php    # Foo\Bar\Qux\QuuxTest
 *
 * ... add the path to the class files for the \Foo\Bar\ namespace prefix
 * as follows:
 *
 *      <?php
 *      // instantiate the loader
 *      $loader = new \Example\Psr4AutoloaderClass;
 *
 *      // register the autoloader
 *      $loader->register();
 *
 *      // register the base directories for the namespace prefix
 *      $loader->addNamespace('Foo\Bar', '/path/to/packages/foo-bar/src');
 *      $loader->addNamespace('Foo\Bar', '/path/to/packages/foo-bar/tests');
 *
 * The following line would cause the autoloader to attempt to load the
 * \Foo\Bar\Qux\Quux class from /path/to/packages/foo-bar/src/Qux/Quux.php:
 *
 *      <?php
 *      new \Foo\Bar\Qux\Quux;
 *
 * The following line would cause the autoloader to attempt to load the
 * \Foo\Bar\Qux\QuuxTest class from /path/to/packages/foo-bar/tests/Qux/QuuxTest.php:
 *
 *      <?php
 *      new \Foo\Bar\Qux\QuuxTest;
 */
class Psr4AutoloaderClass
{
    /**
     * An associative array where the key is a namespace prefix and the value
     * is an array of base directories for classes in that namespace.
     *
     * @var array
     */
    protected $prefixes = array();

    /**
     * Register loader with SPL autoloader stack.
     *
     * @return void
     */
    public function register()
    {
        spl_autoload_register(array($this, 'loadClass'));
    }

    /**
     * Adds a base directory for a namespace prefix.
     *
     * @param string $prefix The namespace prefix.
     * @param string $base_dir A base directory for class files in the
     * namespace.
     * @param bool $prepend If true, prepend the base directory to the stack
     * instead of appending it; this causes it to be searched first rather
     * than last.
     * @return void
     */
    public function addNamespace($prefix, $base_dir, $prepend = false)
    {
        // normalize namespace prefix
        $prefix = trim($prefix, '\\') . '\\';

        // normalize the base directory with a trailing separator
        $base_dir = rtrim($base_dir, DIRECTORY_SEPARATOR) . '/';

        // initialize the namespace prefix array
        if (isset($this->prefixes[$prefix]) === false) {
            $this->prefixes[$prefix] = array();
        }

        // retain the base directory for the namespace prefix
        if ($prepend) {
            array_unshift($this->prefixes[$prefix], $base_dir);
        } else {
            array_push($this->prefixes[$prefix], $base_dir);
        }
    }

    /**
     * Loads the class file for a given class name.
     *
     * @param string $class The fully-qualified class name.
     * @return mixed The mapped file name on success, or boolean false on
     * failure.
     */
    public function loadClass($class)
    {
        // the current namespace prefix
        $prefix = $class;

        // work backwards through the namespace names of the fully-qualified
        // class name to find a mapped file name
        while (false !== $pos = strrpos($prefix, '\\')) {

            // retain the trailing namespace separator in the prefix
            $prefix = substr($class, 0, $pos + 1);

            // the rest is the relative class name
            $relative_class = substr($class, $pos + 1);

            // try to load a mapped file for the prefix and relative class
            $mapped_file = $this->loadMappedFile($prefix, $relative_class);

            if ($mapped_file) {
                return $mapped_file;
            }

            // remove the trailing namespace separator for the next iteration
            // of strrpos()
            $prefix = rtrim($prefix, '\\');
        }

        // never found a mapped file
        return false;
    }

    /**
     * Load the mapped file for a namespace prefix and relative class.
     *
     * @param string $prefix The namespace prefix.
     * @param string $relative_class The relative class name.
     * @return mixed Boolean false if no mapped file can be loaded, or the
     * name of the mapped file that was loaded.
     */
    protected function loadMappedFile($prefix, $relative_class)
    {
        // are there any base directories for this namespace prefix?
        if (isset($this->prefixes[$prefix]) === false) {
            return false;
        }

        // look through base directories for this namespace prefix
        foreach ($this->prefixes[$prefix] as $base_dir) {

            // replace the namespace prefix with the base directory,
            // replace namespace separators with directory separators
            // in the relative class name, append with .php
            $file = $base_dir
                . str_replace('\\', '/', $relative_class)
                . '.php';

            // if the mapped file exists, require it
            if ($this->requireFile($file)) {
                // yes, we're done
                return $file;
            }
        }

        // never found it
        return false;
    }

    /**
     * If a file exists, require it from the file system.
     *
     * @param string $file The file to require.
     * @return bool True if the file exists, false if not.
     */
    protected function requireFile($file)
    {

        if (file_exists($file)) {
            require $file;
            return true;
        }
        else if (file_exists('.'.$file)) {
            require '.'.$file;
            return true;
        }
        return false;
    }
}

--- index.php ---

<?php

require_once 'helpers/Psr4AutoloaderClass.php';

$loader = new Helpers\Psr4AutoloaderClass();
$loader->register();

/**
 * Namespaces → dossiers (relatifs à index.php)
 */
$loader->addNamespace('Helpers', 'helpers');
$loader->addNamespace('League\\Plates', 'vendor/plates/src');
$loader->addNamespace('Controllers', 'controllers');
$loader->addNamespace('Models', 'models');
$loader->addNamespace('Config', 'config');

use Controllers\Router\Router;

// On délègue tout au routeur
$router = new Router();
$router->routing($_GET, $_POST);


--- models\BasePDODAO.php ---

<?php

namespace Models;

use Config\Config;
use PDO;
use PDOException;
use PDOStatement;

class BasePDODAO
{
    private ?PDO $db = null;

    protected function getDB(): PDO
    {
        if ($this->db === null) {
            $dsn  = Config::get('dsn');
            $user = Config::get('user');
            $pass = Config::get('pass');

            try {
                $this->db = new PDO($dsn, $user, $pass);
                $this->db->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
            } catch (PDOException $e) {
                die("Erreur de connexion à la base : " . $e->getMessage());
            }
        }

        return $this->db;
    }

    /**
     * Exécute une requête SQL
     */
    protected function execRequest(string $sql, array $params = null): PDOStatement|false
    {
        $db = $this->getDB();

        if ($params === null) {
            // Requête simple
            return $db->query($sql);
        } else {
            // Requête préparée
            $stmt = $db->prepare($sql);
            $stmt->execute($params);
            return $stmt;
        }
    }
}


--- models\Element.php ---

<?php

namespace Models;

class Element
{
    private ?int $id = null;
    private string $name;
    private ?string $urlImg = null;

    public function getId(): ?int { return $this->id; }
    public function getName(): string { return $this->name; }
    public function getUrlImg(): ?string { return $this->urlImg; }
    

    public function setId(?int $id): void { $this->id = $id; }
    public function setName(string $name): void { $this->name = $name; }
    public function setUrlImg(?string $urlImg): void { $this->urlImg = $urlImg; }
}


--- models\ElementDAO.php ---

<?php

namespace Models;

use PDO;

class ElementDAO extends BasePDODAO
{
    public function createElement(Element $e): bool
    {
        $sql = "INSERT INTO element (name, urlImg)
                VALUES (:name, :urlImg)";

        $params = [
            ':name' => $e->getName(),
            ':urlImg' => $e->getUrlImg()
        ];

        $stmt = $this->execRequest($sql, $params);
        return $stmt !== false && $stmt->rowCount() === 1;
    }

    /**
     * @return Element[]
     */
    public function getAll(): array
    {
        $sql = "SELECT * FROM element ORDER BY name ASC";
        $stmt = $this->execRequest($sql);

        $rows = $stmt->fetchAll(PDO::FETCH_ASSOC);
        $list = [];

        foreach ($rows as $row) {
            $e = new Element();
            $e->setId((int)$row['id']);
            $e->setName($row['name']);
            $e->setUrlImg($row['urlImg'] ?? null);
            $list[] = $e;
        }

        return $list;
    }

    public function getById(int $id): ?Element
    {
        $sql = "SELECT * FROM element WHERE id = ?";
        $stmt = $this->execRequest($sql, [$id]);

        $row = $stmt->fetch(PDO::FETCH_ASSOC);
        if (!$row) return null;

        $e = new Element();
        $e->setId((int)$row['id']);
        $e->setName($row['name']);
        $e->setUrlImg($row['urlImg'] ?? null);

        return $e;
    }
}


--- models\Origin.php ---

<?php

namespace Models;

class Origin
{
    private ?int $id = null;
    private string $name;
    private ?string $urlImg = null;

    public function getId(): ?int { return $this->id; }
    public function getName(): string { return $this->name; }
    public function getUrlImg(): ?string { return $this->urlImg; }

    public function setId(?int $id): void { $this->id = $id; }
    public function setName(string $name): void { $this->name = $name; }
    public function setUrlImg(?string $urlImg): void { $this->urlImg = $urlImg; }
}


--- models\OriginDAO.php ---

<?php

namespace Models;

use PDO;

class OriginDAO extends BasePDODAO
{
    public function createOrigin(Origin $origin): bool
    {
        $sql = "INSERT INTO origin (name, urlImg)
                VALUES (:name, :urlImg)";

        $params = [
            ':name' => $origin->getName(),
            ':urlImg' => $origin->getUrlImg()
        ];

        $stmt = $this->execRequest($sql, $params);
        return $stmt !== false && $stmt->rowCount() === 1;
    }

    /**
     * @return Origin[]
     */
    public function getAll(): array
    {
        $sql = "SELECT * FROM origin ORDER BY name ASC";
        $stmt = $this->execRequest($sql);

        $rows = $stmt->fetchAll(PDO::FETCH_ASSOC);
        $list = [];

        foreach ($rows as $row) {
            $o = new Origin();
            $o->setId((int)$row['id']);
            $o->setName($row['name']);
            $o->setUrlImg($row['urlImg'] ?? null);
            $list[] = $o;
        }

        return $list;
    }

    public function getById(int $id): ?Origin
    {
        $sql = "SELECT * FROM origin WHERE id = ?";
        $stmt = $this->execRequest($sql, [$id]);

        $row = $stmt->fetch(PDO::FETCH_ASSOC);
        if (!$row) return null;

        $o = new Origin();
        $o->setId((int)$row['id']);
        $o->setName($row['name']);
        $o->setUrlImg($row['urlImg'] ?? null);

        return $o;
    }
}


--- models\Personnage.php ---

<?php

namespace Models;

class Personnage
{
    private ?string $id = null;
    private string $name;
    private int $rarity;
    private string $urlImg;

    // IDs internes pour le DAO / Service
    private ?int $elementId = null;
    private ?int $unitclassId = null;
    private ?int $originId = null;

    // Objets liés hydratés par le service
    private ?Element $element = null;
    private ?UnitClass $unitclass = null;
    private ?Origin $origin = null;

    // --- GETTERS / SETTERS généraux ---
    public function getId(): ?string { return $this->id; }
    public function getName(): string { return $this->name; }
    public function getRarity(): int { return $this->rarity; }
    public function getUrlImg(): string { return $this->urlImg; }

    public function setId(?string $id): void { $this->id = $id; }
    public function setName(string $name): void { $this->name = $name; }
    public function setRarity(int $rarity): void { $this->rarity = $rarity; }
    public function setUrlImg(string $urlImg): void { $this->urlImg = $urlImg; }

    // --- GETTERS / SETTERS des IDs internes ---
    public function getElementId(): ?int { return $this->elementId; }
    public function getUnitclassId(): ?int { return $this->unitclassId; }
    public function getOriginId(): ?int { return $this->originId; }

    public function setElementId(?int $id): void { $this->elementId = $id; }
    public function setUnitclassId(?int $id): void { $this->unitclassId = $id; }
    public function setOriginId(?int $id): void { $this->originId = $id; }

    // --- GETTERS / SETTERS des objets liés ---
    public function getElement(): ?Element { return $this->element; }
    public function getUnitclass(): ?UnitClass { return $this->unitclass; }
    public function getOrigin(): ?Origin { return $this->origin; }

    public function setElement(?Element $element): void { $this->element = $element; }
    public function setUnitclass(?UnitClass $unitclass): void { $this->unitclass = $unitclass; }
    public function setOrigin(?Origin $origin): void { $this->origin = $origin; }
}


--- models\PersonnageDAO.php ---

<?php

namespace Models;

use PDO;

class PersonnageDAO extends BasePDODAO
{
    /**
     * Retourne tous les personnages avec leurs attributs hydratés
     *
     * @return Personnage[]
     */
    public function getAll(): array
    {
        $sql = "
            SELECT 
                p.*,
                e.name  AS element_name,
                e.urlImg AS element_img,
                o.name  AS origin_name,
                o.urlImg AS origin_img,
                u.name  AS unitclass_name,
                u.urlImg AS unitclass_img
            FROM personnage p
            LEFT JOIN element   e ON p.element_id   = e.id
            LEFT JOIN origin    o ON p.origin_id    = o.id
            LEFT JOIN unitclass u ON p.unitclass_id = u.id
        ";

        $stmt = $this->execRequest($sql);
        $rows = $stmt->fetchAll(PDO::FETCH_ASSOC);

        $list = [];

        foreach ($rows as $row) {
            $p = new Personnage();
            $p->setId($row['id']);
            $p->setName($row['name']);
            $p->setRarity((int)$row['rarity']);
            $p->setUrlImg($row['urlImg']);

            $p->setElementId($row['element_id']);
            $p->setUnitclassId($row['unitclass_id']);
            $p->setOriginId($row['origin_id']);

            // Hydratation des objets liés
            if ($row['element_id'] !== null) {
                $e = new Element();
                $e->setId((int)$row['element_id']);
                $e->setName($row['element_name']);
                $e->setUrlImg($row['element_img']);
                $p->setElement($e);
            }

            if ($row['unitclass_id'] !== null) {
                $u = new UnitClass();
                $u->setId((int)$row['unitclass_id']);
                $u->setName($row['unitclass_name']);
                $u->setUrlImg($row['unitclass_img']);
                $p->setUnitclass($u);
            }

            if ($row['origin_id'] !== null) {
                $o = new Origin();
                $o->setId((int)$row['origin_id']);
                $o->setName($row['origin_name']);
                $o->setUrlImg($row['origin_img']);
                $p->setOrigin($o);
            }

            $list[] = $p;
        }

        return $list;
    }

    /**
     * Récupère un personnage par ID avec attributs hydratés
     */
    public function getByID(string $id): ?Personnage
    {
        $sql = "
            SELECT 
                p.*,
                e.name  AS element_name,
                e.urlImg AS element_img,
                o.name  AS origin_name,
                o.urlImg AS origin_img,
                u.name  AS unitclass_name,
                u.urlImg AS unitclass_img
            FROM personnage p
            LEFT JOIN element   e ON p.element_id   = e.id
            LEFT JOIN origin    o ON p.origin_id    = o.id
            LEFT JOIN unitclass u ON p.unitclass_id = u.id
            WHERE p.id = ?
        ";

        $stmt = $this->execRequest($sql, [$id]);
        $row = $stmt->fetch(PDO::FETCH_ASSOC);

        if (!$row) {
            return null;
        }

        $p = new Personnage();
        $p->setId($row['id']);
        $p->setName($row['name']);
        $p->setRarity((int)$row['rarity']);
        $p->setUrlImg($row['urlImg']);

        $p->setElementId($row['element_id']);
        $p->setUnitclassId($row['unitclass_id']);
        $p->setOriginId($row['origin_id']);

        if ($row['element_id'] !== null) {
            $e = new Element();
            $e->setId((int)$row['element_id']);
            $e->setName($row['element_name']);
            $e->setUrlImg($row['element_img']);
            $p->setElement($e);
        }

        if ($row['unitclass_id'] !== null) {
            $u = new UnitClass();
            $u->setId((int)$row['unitclass_id']);
            $u->setName($row['unitclass_name']);
            $u->setUrlImg($row['unitclass_img']);
            $p->setUnitclass($u);
        }

        if ($row['origin_id'] !== null) {
            $o = new Origin();
            $o->setId((int)$row['origin_id']);
            $o->setName($row['origin_name']);
            $o->setUrlImg($row['origin_img']);
            $p->setOrigin($o);
        }

        return $p;
    }

    /**
     * Création d'un personnage
     */
    public function createPersonnage(Personnage $p): bool
    {
        $sql = "INSERT INTO personnage (id, name, element_id, unitclass_id, origin_id, rarity, urlImg)
                VALUES (:id, :name, :element_id, :unitclass_id, :origin_id, :rarity, :urlImg)";

        $params = [
            ':id'            => $p->getId(),
            ':name'          => $p->getName(),
            ':element_id'    => $p->getElementId(),
            ':unitclass_id'  => $p->getUnitclassId(),
            ':origin_id'     => $p->getOriginId(),
            ':rarity'        => $p->getRarity(),
            ':urlImg'        => $p->getUrlImg(),
        ];

        $stmt = $this->execRequest($sql, $params);
        return $stmt !== false && $stmt->rowCount() === 1;
    }

    /**
     * Mise à jour d'un personnage
     */
    public function updatePersonnage(Personnage $p): bool
    {
        $sql = "UPDATE personnage
                SET name = :name,
                    element_id = :element_id,
                    unitclass_id = :unitclass_id,
                    origin_id = :origin_id,
                    rarity = :rarity,
                    urlImg = :urlImg
                WHERE id = :id";

        $params = [
            ':id'            => $p->getId(),
            ':name'          => $p->getName(),
            ':element_id'    => $p->getElementId(),
            ':unitclass_id'  => $p->getUnitclassId(),
            ':origin_id'     => $p->getOriginId(),
            ':rarity'        => $p->getRarity(),
            ':urlImg'        => $p->getUrlImg(),
        ];

        $stmt = $this->execRequest($sql, $params);
        return $stmt !== false && $stmt->rowCount() === 1;
    }

    /**
     * Suppression simple
     */
    public function deletePerso(string $id): bool
    {
        $sql = "DELETE FROM personnage WHERE id = ?";
        $stmt = $this->execRequest($sql, [$id]);
        return $stmt !== false && $stmt->rowCount() === 1;
    }
}


--- models\UnitClass.php ---

<?php

namespace Models;

class UnitClass
{
    private ?int $id = null;
    private string $name;
    private ?string $urlImg = null;

    public function getId(): ?int { return $this->id; }
    public function getName(): string { return $this->name; }
    public function getUrlImg(): ?string { return $this->urlImg; }

    public function setId(?int $id): void { $this->id = $id; }
    public function setName(string $name): void { $this->name = $name; }
    public function setUrlImg(?string $urlImg): void { $this->urlImg = $urlImg; }
}


--- models\UnitClassDAO.php ---

<?php

namespace Models;

use PDO;

class UnitClassDAO extends BasePDODAO
{
    public function createUnitClass(UnitClass $u): bool
    {
        $sql = "INSERT INTO unitclass (name, urlImg)
                VALUES (:name, :urlImg)";

        $params = [
            ':name' => $u->getName(),
            ':urlImg' => $u->getUrlImg()
        ];

        $stmt = $this->execRequest($sql, $params);
        return $stmt !== false && $stmt->rowCount() === 1;
    }

    /**
     * @return UnitClass[]
     */
    public function getAll(): array
    {
        $sql = "SELECT * FROM unitclass ORDER BY name ASC";
        $stmt = $this->execRequest($sql);

        $rows = $stmt->fetchAll(PDO::FETCH_ASSOC);
        $list = [];

        foreach ($rows as $row) {
            $u = new UnitClass();
            $u->setId((int)$row['id']);
            $u->setName($row['name']);
            $u->setUrlImg($row['urlImg'] ?? null);
            $list[] = $u;
        }

        return $list;
    }

    public function getById(int $id): ?UnitClass
    {
        $sql = "SELECT * FROM unitclass WHERE id = ?";
        $stmt = $this->execRequest($sql, [$id]);

        $row = $stmt->fetch(PDO::FETCH_ASSOC);
        if (!$row) return null;

        $u = new UnitClass();
        $u->setId((int)$row['id']);
        $u->setName($row['name']);
        $u->setUrlImg($row['urlImg'] ?? null);

        return $u;
    }
}


--- public\css\main.css ---

/* Layout général */
body {
    font-family: Arial, sans-serif;
    background: #f5f5f5;
    margin: 0;
}

header {
    background: #2c3e50;
    color: white;
    padding: 10px 20px;
}

header nav ul {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    gap: 15px;
}

header nav a {
    color: white;
    text-decoration: none;
    font-weight: 500;
}

header nav a:hover {
    text-decoration: underline;
}

main#contenu {
    max-width: 1100px;
    margin: 20px auto;
    padding: 0 15px 40px;
}

/* Cartes / formulaires */
.card {
    background: white;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.06);
}

.form-card {
    margin-top: 20px;
}

.form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px 30px;
}

.form-field {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.form-field label {
    font-weight: 600;
    font-size: 0.95rem;
}

.form-field input {
    padding: 8px 10px;
    border-radius: 4px;
    border: 1px solid #ccc;
    font-size: 0.95rem;
}

.form-actions {
    grid-column: 1 / -1;
    display: flex;
    gap: 10px;
    justify-content: flex-start;
    margin-top: 10px;
}

/* Boutons */
.btn-primary,
.btn-secondary,
.btn-option {
    display: inline-block;
    padding: 8px 14px;
    border-radius: 4px;
    border: 1px solid transparent;
    font-size: 0.9rem;
    cursor: pointer;
    text-decoration: none;
}

.btn-primary {
    background: #3498db;
    color: white;
    border-color: #2980b9;
}

.btn-secondary {
    background: #ecf0f1;
    color: #2c3e50;
    border-color: #bdc3c7;
}

.btn-primary:hover,
.btn-secondary:hover {
    opacity: 0.9;
}

/* Message */
.alert {
    margin-bottom: 15px;
    padding: 10px 15px;
    border-radius: 4px;
    background: #e8f4fd;
    border: 1px solid #a5c9f5;
    color: #1b4f72;
}

/* Images des personnages dans la liste */
.perso-img {
    width: 80px;      /* largeur fixe */
    height: auto;     /* garde les proportions */
    border-radius: 6px;
    object-fit: cover; /* recadre proprement si besoin */
}

/* Variantes de messages */
.alert-info {
    background: #e8f4fd;
    border-color: #a5c9f5;
    color: #1b4f72;
}

.alert-success {
    background: #e8f8f0;
    border-color: #a3e4b5;
    color: #1e5f3a;
}

.alert-error {
    background: #fdecea;
    border-color: #f5b7b1;
    color: #7b241c;
}



--- views\add-origin.php ---

<?php
/** @var mixed $message */
$this->layout('template', ['title' => 'Ajouter une origine', 'message' => $message]);
?>

<h1>Ajouter une origine</h1>

<div class="card form-card">
    <form action="index.php?action=add-origin" method="post" class="form-grid">

        <div class="form-field">
            <label for="origin-name">Nom de l’origine *</label>
            <input type="text" id="origin-name" name="origin-name" required placeholder="Mondstadt, Liyue...">
        </div>

        <div class="form-field">
            <label for="origin-img">URL de l’icône</label>
            <input type="url" id="origin-img" name="origin-img" placeholder="https://">
        </div>

        <div class="form-actions">
            <button type="submit" class="btn-primary">Ajouter</button>
            <a href="index.php" class="btn-secondary">Retour</a>
        </div>

    </form>
</div>


--- views\add-perso-element.php ---

<?php
/** @var mixed $message */
$this->layout('template', ['title' => 'Ajouter un élément', 'message' => $message]);
?>

<h1>Ajouter un élément</h1>

<div class="card form-card">
    <form action="index.php?action=add-perso-element" method="post" class="form-grid">

        <div class="form-field">
            <label for="element-name">Nom de l’élément *</label>
            <input type="text" id="element-name" name="element-name" required placeholder="Pyro, Hydro...">
        </div>

        <div class="form-field">
            <label for="element-img">URL de l’icône *</label>
            <input type="url" id="element-img" name="element-img" required placeholder="https://">
        </div>

        <div class="form-actions">
            <button type="submit" class="btn-primary">Ajouter</button>
            <a href="index.php" class="btn-secondary">Retour</a>
        </div>

    </form>
</div>


--- views\add-perso.php ---

<?php
/** @var mixed $message */
/** @var ?\Models\Personnage $perso */
/** @var string $mode */
/** @var \Models\Element[] $elements */
/** @var \Models\UnitClass[] $unitclasses */
/** @var \Models\Origin[] $origins */

$mode = $mode ?? 'create'; // 'create' ou 'edit'
$isEdit = $mode === 'edit';

$titlePage = $isEdit ? 'Modifier un personnage' : 'Ajouter un personnage';
$actionUrl = $isEdit
    ? 'index.php?action=edit-perso'
    : 'index.php?action=add-perso';

$buttonText = $isEdit ? 'Enregistrer les modifications' : 'Ajouter le personnage';

// Sélection actuelle (mode édition)
$selectedElementId   = isset($perso) ? $perso->getElementId()   : null;
$selectedUnitclassId = isset($perso) ? $perso->getUnitclassId() : null;
$selectedOriginId    = isset($perso) ? $perso->getOriginId()    : null;

$val = fn($getter, $default = '') =>
    isset($perso) ? htmlspecialchars($perso->$getter(), ENT_QUOTES, 'UTF-8') : $default;
?>

<?php $this->layout('template', ['title' => $titlePage, 'message' => $message]); ?>

<h1><?= $titlePage ?></h1>

<div class="card form-card">
    <form action="<?= $actionUrl ?>" method="post" class="form-grid">

        <?php if ($isEdit && isset($perso)) : ?>
            <input type="hidden" name="idPerso" value="<?= $val('getId') ?>">
        <?php endif; ?>

        <!-- Nom -->
        <div class="form-field">
            <label for="perso-nom">Nom *</label>
            <input type="text" id="perso-nom" name="perso-nom"
                   required
                   value="<?= $val('getName') ?>">
        </div>

        <!-- Élément -->
        <div class="form-field">
            <label for="perso-element">Élément *</label>
            <select id="perso-element" name="perso-element" required>
                <option value="">-- Choisir un élément --</option>

                <?php foreach ($elements as $e): ?>
                    <option value="<?= $e->getId() ?>"
                        <?= ($selectedElementId === $e->getId()) ? 'selected' : '' ?>>
                        <?= $this->e($e->getName()) ?>
                    </option>
                <?php endforeach; ?>

            </select>
        </div>

        <!-- Classe -->
        <div class="form-field">
            <label for="perso-unitclass">Classe / Arme *</label>
            <select id="perso-unitclass" name="perso-unitclass" required>
                <option value="">-- Choisir une classe --</option>

                <?php foreach ($unitclasses as $u): ?>
                    <option value="<?= $u->getId() ?>"
                        <?= ($selectedUnitclassId === $u->getId()) ? 'selected' : '' ?>>
                        <?= $this->e($u->getName()) ?>
                    </option>
                <?php endforeach; ?>

            </select>
        </div>

        <!-- Rareté -->
        <div class="form-field">
            <label for="perso-rarity">Rareté (4, 5...) *</label>
            <input type="number" id="perso-rarity" name="perso-rarity"
                   min="1" max="5" step="1"
                   required
                   value="<?= $val('getRarity') ?>">
        </div>

        <!-- Origine -->
        <div class="form-field">
            <label for="perso-origin">Origine</label>
            <select id="perso-origin" name="perso-origin">
                <option value="">-- Aucune / Inconnue --</option>

                <?php foreach ($origins as $o): ?>
                    <option value="<?= $o->getId() ?>"
                        <?= ($selectedOriginId === $o->getId()) ? 'selected' : '' ?>>
                        <?= $this->e($o->getName()) ?>
                    </option>
                <?php endforeach; ?>

            </select>
        </div>

        <!-- Image -->
        <div class="form-field">
            <label for="perso-url-img">URL de l’image *</label>
            <input type="url" id="perso-url-img" name="perso-url-img"
                   placeholder="https://..."
                   required
                   value="<?= $val('getUrlImg') ?>">
        </div>

        <!-- Boutons -->
        <div class="form-actions">
            <button type="submit" class="btn-primary">
                <?= $buttonText ?>
            </button>

            <a href="index.php" class="btn-secondary">Retour à la liste</a>
        </div>

    </form>
</div>


<option value="<?= $e->getId() ?>"
    data-icon="<?= $e->getUrlImg() ?>"
    <?= ($selectedElementId === $e->getId()) ? 'selected' : '' ?>>
    <?= $this->e($e->getName()) ?>
</option>


--- views\add-unitclass.php ---

<?php
/** @var mixed $message */
$this->layout('template', ['title' => 'Ajouter une classe', 'message' => $message]);
?>

<h1>Ajouter une classe / arme</h1>

<div class="card form-card">
    <form action="index.php?action=add-unitclass" method="post" class="form-grid">

        <div class="form-field">
            <label for="unitclass-name">Nom de la classe *</label>
            <input type="text" id="unitclass-name" name="unitclass-name" required placeholder="Épéiste, Mage...">
        </div>

        <div class="form-field">
            <label for="unitclass-img">URL de l’icône</label>
            <input type="url" id="unitclass-img" name="unitclass-img" placeholder="https://">
        </div>

        <div class="form-actions">
            <button type="submit" class="btn-primary">Ajouter</button>
            <a href="index.p


--- views\home.php ---

<?php

$this->layout('template', ['title' => 'TP Mihoyo']);

?>

<h1>Collection <?= $this->e($gameName) ?></h1>

<?php if (!empty($listPersonnage)) : ?>
    <table class="perso-table">
        <thead>
        <tr>
            <th>Image</th>
            <th>Nom</th>
            <th>Élément</th>
            <th>Classe</th>
            <th>Rareté</th>
            <th>Origine</th>
            <th>Options</th>
        </tr>
        </thead>
        <tbody>
        <?php foreach ($listPersonnage as $perso) : ?>
            <tr>
                <td>
                    <?php if ($perso->getUrlImg()) : ?>
                        <img src="<?= $this->e($perso->getUrlImg()) ?>" 
                             alt="<?= $this->e($perso->getName()) ?>" 
                             class="perso-img">
                    <?php else : ?>
                        -
                    <?php endif; ?>
                </td>

                <td><?= $this->e($perso->getName()) ?></td>

                <!-- Élément -->
                <td>
                    <?php $el = $perso->getElement(); ?>
                    <?= $this->e($el ? $el->getName() : '-') ?>
                </td>

                <!-- Classe -->
                <td>
                    <?php $uc = $perso->getUnitclass(); ?>
                    <?= $this->e($uc ? $uc->getName() : '-') ?>
                </td>

                <td><?= $this->e($perso->getRarity()) ?>★</td>

                <!-- Origine -->
                <td>
                    <?php $orig = $perso->getOrigin(); ?>
                    <?= $this->e($orig ? $orig->getName() : 'Inconnue') ?>
                </td>

                <td class="perso-options">
                    <a href="index.php?action=edit-perso&id=<?= $this->e($perso->getId()) ?>" 
                       class="btn-option btn-edit">Modifier</a>

                    <a href="index.php?action=del-perso&id=<?= $this->e($perso->getId()) ?>" 
                       class="btn-option btn-delete">Supprimer</a>
                </td>
            </tr>
        <?php endforeach; ?>
        </tbody>
    </table>
<?php else : ?>
    <p>Aucun personnage en base pour le moment.</p>
<?php endif; ?>


--- views\login.php ---

<?php $this->layout('template', ['title' => 'Login']); ?>

<h1>Page : Login</h1>


--- views\logs.php ---

<?php $this->layout('template', ['title' => 'Logs']); ?>

<h1>Page : Logs</h1>

--- views\message.php ---

<?php
/** @var \Helpers\Message $message */
?>

<div class="alert <?= htmlspecialchars($message->getColor(), ENT_QUOTES, 'UTF-8') ?>">
    <?php if ($message->getTitle() !== '') : ?>
        <strong><?= htmlspecialchars($message->getTitle(), ENT_QUOTES, 'UTF-8') ?></strong><br>
    <?php endif; ?>

    <?= nl2br(htmlspecialchars($message->getMessage(), ENT_QUOTES, 'UTF-8')) ?>
</div>


--- views\template.php ---

<!doctype html>
<html lang="fr">
<head>
    <meta charset="UTF-8"/>
    <link rel="stylesheet" href="public/css/main.css"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title><?= $this->e($title) ?></title>
</head>
<body>

<header>
    <nav>
        <ul>
            <li><a href="index.php">Accueil</a></li>
            <li><a href="index.php?action=add-perso">Ajouter un personnage</a></li>
            <li><a href="index.php?action=add-perso-element">Ajouter un élément</a></li>
            <li><a href="index.php?action=logs">Logs</a></li>
            <li><a href="index.php?action=login">Login</a></li>
        </ul>
    </nav>
</header>

<main id="contenu">
    <?php
    use Helpers\Message;
    ?>

    <?php if (isset($message) && $message instanceof Message): ?>
        <?= $this->insert('message', ['message' => $message]) ?>
    <?php elseif (!empty($message)): ?>
        <?php
        // Compatibilité : si on passe encore une simple string
        $msgObj = new Message((string)$message);
        echo $this->insert('message', ['message' => $msgObj]);
        ?>
    <?php endif; ?>

    <?= $this->section('content') ?>
</main>

<footer>
</footer>

</body>
</html>

<script>
document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll("select").forEach(select => {

        select.addEventListener("change", function() {
            const opt = this.selectedOptions[0];
            if (opt && opt.dataset.icon) {
                this.style.backgroundImage = `url('${opt.dataset.icon}')`;
                this.style.backgroundRepeat = "no-repeat";
                this.style.backgroundSize   = "24px 24px";
                this.style.backgroundPosition = "8px center";
            } else {
                this.style.backgroundImage = "none";
            }
        });

        // initialisation sélectionnée
        const opt = select.selectedOptions[0];
        if (opt && opt.dataset.icon) {
            select.style.backgroundImage = `url('${opt.dataset.icon}')`;
            select.style.backgroundRepeat = "no-repeat";
            select.style.backgroundSize   = "24px 24px";
            select.style.backgroundPosition = "8px center";
        }
    });
});
</script>

